# 异常控制流

## 控制流
想象一下你有一个指令地址的序列，指令地址指向具体的指令，然后你的处理器要不断去从指令地址读取指令来执行。这个过程中，从上一个指令到下一个指令的过度叫做控制转移，这样的控制转移序列就叫做处理器的控制流。  
控制流是一种“平滑”的序列，其中每个指令地址在内存中都是相邻的，但是有的时候这个“平滑”的序列需要发生“突变”，比如遇到跳转、调用或者返回指令。  
系统也需要对系统状态的变化作出反应，而这些系统状态不时被内部程序变量捕获的，也不一定和程序的执行有关系。比如网卡收到数据、键盘按键、鼠标移动等等，这些信号必须要有相应的处理程序进行处理。  
## 异常控制流
为了处理上面的情况，现代系统会使控制流发生突变，这些突变就叫做异常控制流。比如硬件检测到的事件会让控制突然转移到异常处理程序。在操作系统层，内核通过上下文切换将控制从一个用户进程转移到另一个用户进程；在应用层，一个进程可以给另一个进程发送信号，接收者会将控制突然转移到它的一个信号处理程序。
## 异常分类
- 中断（来自 I/O 设备的信号，异步）  
    比如网络适配器、磁盘控制器、定时器等通过发送信号并将异常信号放到系统总线上触发中断。
- 陷阱（有意的异常，同步）  
    比如系统调用（`syscall`）
- 故障（潜在的可恢复错误，同步）  
    比如缺页异常：指令引用了一个虚拟地址，该地址不存在在物理内存中，需要从磁盘取出时发生
- 终止（不可恢复的错误，同步）  
    致命错误